<!DOCTYPE html>
<html lang="he" dir="rtl" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{fragments/header :: header}"></head>
<body class="d-flex flex-column min-vh-100">
<!-- Navigation -->
<nav th:replace="~{fragments/header :: navigation}"></nav>

<!-- Main Content -->
<main class="flex-grow-1">
    <section class="container py-5 mt-4">
        <div class="mb-4 mt-3 d-flex justify-content-between align-items-center">
            <h2 class="fw-bold mb-0">שלום <span sec:authentication="principal.firstName"></span>!</h2>
            <a sec:authorize="hasAnyRole('COMMANDER', 'ADMIN')"
               href="/positions/add" class="btn btn-primary rounded-3 ">
                הוסף משרה <i class="bi bi-plus-circle ms-1"></i>
            </a>
        </div>

        <div class="card mb-4 shadow-sm p-3 rounded-4">
            <div class="row g-3 align-items-end">
                <div class="col-md-6">
                    <label th:for="location">מיקום</label>
                    <select id="location" name="location" class="form-select rounded-3">
                        <option value="" selected>הכל</option>
                        <option th:each="region : ${locations}"
                                th:value="${region}"
                                th:text="${region}">
                        </option>
                    </select>
                </div>

                <div class="col-md-6">
                    <label th:for="serviceType">סוג שירות</label>
                    <select id="serviceType" name="serviceType" class="form-select rounded-3">
                        <option value="">הכל</option>
                        <option th:each="type : ${serviceTypes}"
                                th:value="${type}"
                                th:text="${type}">
                        </option>
                    </select>
                </div>
            </div>
        </div>

        <div class="input-group mb-4">
            <input type="text" id="searchBox" class="form-control" placeholder="חפש משרה לפי שם...">
            <button class="input-group-text" id="searchButton" type="button">
                <i class="bi bi-search"></i>
            </button>
        </div>
        <div id="recentSearches" class="mb-3">
            <strong>חיפושים אחרונים:</strong>
            <span id="recentSearchesList">
                <button type="button"
                        class="btn btn-sm btn-outline-secondary ms-2 mb-1 recentSearchBtn"
                        th:each="recentSearch : ${recentSearches}"
                        th:text="${recentSearch}">
                </button>
            </span>
        </div>

        <div id="noPositionsMsg" class="alert alert-warning text-center rounded-3 shadow-sm d-none">
            אין משרות זמינות להצגה.
        </div>

        <!-- Job Cards -->
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" th:id="job-cards">
            <div class="col" th:each="job : ${jobs}"
                 th:attr="data-location=${job.location}, data-assignment-type=${job.assignmentType}">
                <div class="card h-100 shadow-sm rounded-4">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title fw-bold" th:text="${job.jobTitle}">שם משרה</h5>
                        <p class="mb-1"><strong>מיקום:</strong> <span th:text="${job.location}"></span></p>
                        <p class="mb-1"><strong>סוג שירות:</strong> <span th:text="${job.AssignmentType}"></span></p>
                        <p class="mb-1">
                            <strong>דרישות:</strong>
                            <span th:text="${#strings.abbreviate(job.requirements, 50)}"></span>
                        </p>
                        <p class="card-text text-muted flex-grow-1"
                           th:text="${#strings.abbreviate(job.description, 100)}"></p>
                        <p class="mb-1"><strong>מפורסם ע"י:</strong> <span th:text="${job.publisher.firstName + ' ' + job.publisher.lastName}"></span></p>
                        <a th:href="@{'/positions/' + ${job.id}}" class="btn btn-outline-primary mt-3 rounded-3">לפרטי המשרה</a>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<div th:replace="~{fragments/toasts :: toast}"></div>
<script th:src="@{/js/positionsPage.js}" type="module"></script>
<footer th:replace="~{fragments/footer :: footer}"></footer>
</body>
</html>
